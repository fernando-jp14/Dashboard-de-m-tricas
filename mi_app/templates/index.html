{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Dashboard de Rendimiento Web</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="{% static 'style.css' %}">
</head>
<body>
    <div class="container {% if json_data %}form-arriba{% endif %}">
        <h1>Dashboard de Rendimiento Web</h1>

        {% if error %}
        <div class="alert alert-error">{{ error }}</div>
        {% endif %}
        {% if success %}
        <div class="alert alert-success">{{ success }}</div>
        {% endif %}

        <form method="post" enctype="multipart/form-data" id="uploadForm">
            {% csrf_token %}
            <input type="file" name="json_file" id="jsonFile" accept=".json" required>
            <button type="submit">Cargar JSON</button>
        </form>

        {% if json_data %}
        <div class="charts">
            <div class="chart-container">
                <h3>Tiempo de Carga</h3>
                <canvas id="loadTimeChart"></canvas>
            </div>
            <div class="chart-container">
                <h3>Solicitudes HTTP</h3>
                <canvas id="requestsChart"></canvas>
            </div>
            <div class="chart-container">
                <h3>Desglose de Tiempos</h3>
                <canvas id="timingBreakdownChart"></canvas>
            </div>
        </div>

        <hr>

        <h2 class="sub">Resumen de Métricas</h2>
        <div class="resumen">
            <div class="card"><strong>URL:</strong> <span>{{ metrics.0.url }}</span></div>
            <div class="card"><strong>Tiempo de Carga:</strong> <span>{{ metrics.0.tiempo_carga }}</span></div>
            <div class="card"><strong>Uso de Memoria:</strong> <span>{{ metrics.0.uso_memoria }}</span></div>
            <div class="card"><strong>Solicitudes HTML:</strong> <span>{{ metrics.0.solicitudes_html }}</span></div>
            <div class="card"><strong>Solicitudes CSS:</strong> <span>{{ metrics.0.solicitudes_css }}</span></div>
            <div class="card"><strong>Solicitudes JS:</strong> <span>{{ metrics.0.solicitudes_js }}</span></div>
            <div class="card"><strong>Solicitudes Imágenes:</strong> <span>{{ metrics.0.solicitudes_imagenes }}</span></div>
            <div class="card"><strong>Solicitudes Fuentes:</strong> <span>{{ metrics.0.solicitudes_fuentes }}</span></div>
            <div class="card"><strong>Solicitudes Otros:</strong> <span>{{ metrics.0.solicitudes_otros }}</span></div>
        </div>
        <div class="card center-card"><strong>Total de Solicitudes:</strong> <span>{{ metrics.0.total_solicitudes }}</span></div>
        {% endif %}
    </div>

    {% if json_data %}
    <script id="chart-data" type="application/json">
        {{ json_data|safe }}
    </script>
    {% endif %}
    <script src="{% static 'script.js' %}"></script>
</body>
</html>
